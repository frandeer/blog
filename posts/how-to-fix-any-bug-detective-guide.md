# AI도 못 잡은 버그를 잡는 4단계 탐정 기술

여러분은 이런 경험 있으신가요?

"이상하다... 분명 이 코드는 작동해야 하는데?" 라며 몇 시간째 모니터를 바라보고 있는 자신을 발견하는 순간. 혹은 AI에게 "이 버그 좀 고쳐줘"라고 했는데, AI가 자신 있게 고쳤다고 하지만... 여전히 버그는 그대로인 황당한 상황.

Dan Abramov(React 핵심 개발자)가 최근 흥미로운 경험을 공유했습니다. Claude AI와 함께 코딩하다가 버그를 만났는데, Claude가 여러 번 "고쳤다"고 자신 있게 말했지만 실제로는 아무것도 해결되지 않았다는 이야기입니다.

**왜 이런 일이 벌어질까요?**

AI든 사람이든, 똑같은 실수를 합니다. **재현(repro) 없이 버그를 고치려 한다는 것.** 이건 마치 지도도 없이 보물찾기를 하는 것과 같습니다.

오늘은 Dan Abramov의 실제 사례를 바탕으로, 어떤 버그든 체계적으로 해결하는 4단계 탐정 기술을 알려드리겠습니다. 복잡한 이론이 아닌, 바로 내일부터 쓸 수 있는 실용적인 방법입니다.

---

## 🎯 핵심 원칙: 버그는 과학이다

버그를 고치는 것은 예술이 아닙니다. **과학**입니다.

요리를 생각해봅시다. 레시피 없이 요리하면 어떻게 될까요? 운 좋으면 맛있을 수도 있지만, 같은 맛을 다시 만들 수 없습니다. 버그도 마찬가지입니다. **재현 가능한 레시피**가 있어야 합니다.

---

## 🔍 Step 0: 그냥 고쳐보기 (대부분 실패하는 방법)

Dan은 Claude에게 스크롤 버그를 고쳐달라고 했습니다.

```
문제: 버튼을 클릭하면 다음 카드로 스크롤되어야 하는데,
서버 호출을 추가하니까 스크롤이 흔들리고 이상해졌어요.
```

Claude는 자신만만하게:
- `useEffect` 조건을 수정했습니다. "고쳤어요!"
- `smooth` 스크롤을 `instant`로 바꿨습니다. "이제 됐어요!"
- 다른 것도 시도했습니다. "완벽해요!"

**하지만 아무것도 고쳐지지 않았습니다.**

왜일까요? Claude는 **버그를 직접 볼 수 없었기 때문**입니다. "스크롤이 흔들린다"는 말은 Claude에게 아무 의미가 없었죠. 검증할 방법이 없으니, 추측만 할 뿐이었습니다.

**교훈**: 버그를 검증할 명확한 방법 없이 고치려는 시도는 시간 낭비입니다.

---

## 🎬 Step 1: 재현을 찾기 (버그 레시피 만들기)

**재현(Repro)이란?** 버그를 100% 다시 만들어낼 수 있는 단계별 지침입니다.

좋은 재현은 세 가지를 명확히 합니다:
1. **무엇을 하는가** (어떤 버튼을 클릭)
2. **무엇이 나와야 하는가** (아래로 스크롤)
3. **실제로 무엇이 나오는가** (스크롤이 흔들림)

### 비유: 요리 레시피

재현은 요리 레시피와 같습니다:

**나쁜 레시피:**
> "맛있는 음식 만들기"

**좋은 레시피:**
> 1. 물 500ml를 끓인다
> 2. 면을 3분간 삶는다
> 3. 결과: 탱탱한 면이 나와야 함
> 4. 실제: 면이 눌어붙어 있음

Dan의 첫 재현:
```
1. 버튼 클릭
2. 기대: 아래로 부드럽게 스크롤
3. 실제: 스크롤이 흔들림
```

문제는? Claude가 화면을 볼 수 없어서 이 재현을 따를 수 없다는 것!

---

## 🔬 Step 2: 재현을 좁히기 (측정 가능하게 만들기)

Dan은 재현을 **측정 가능한 것**으로 바꿨습니다:

**새로운 재현:**
```javascript
1. 스크롤 위치를 console.log로 출력
2. 버튼 클릭
3. 다시 스크롤 위치 출력
4. 기대: 위치가 변해야 함
5. 실제: 위치가 변하지 않음
```

이제 Claude도 버그를 "볼" 수 있게 되었습니다! 콘솔 로그로 숫자를 확인할 수 있으니까요.

### ⚠️ 주의사항: 다른 버그를 잡고 있는 건 아닐까?

재현을 바꿀 때 가장 큰 함정은 **완전히 다른 버그**를 잡고 있을 수 있다는 것입니다.

**검증 방법:** 원래 문제를 해결하는 것으로 알려진 방법이 새 재현에서도 작동하는지 확인하세요.

Dan의 검증:
```
1. 네트워크 호출을 주석 처리 (원래 문제를 해결함)
2. 새 재현 실행
3. 결과: 스크롤 위치가 변함! ✅
4. 네트워크 호출을 다시 활성화
5. 새 재현 실행
6. 결과: 스크롤 위치가 변하지 않음! ✅
```

이제 확신할 수 있습니다. 새 재현이 원래 문제를 올바르게 포착하고 있다고요!

### 비유: 범인 좁히기

재현을 좁히는 것은 범인을 찾는 것과 같습니다:

- **처음:** "이 마을 어딘가에 범인이 있다" (너무 광범위)
- **좁힌 후:** "키 180cm, 파란 자켓을 입은 사람" (구체적)
- **검증:** 알려진 용의자가 이 특징에 맞는지 확인

---

## 🧹 Step 3: 다른 모든 것을 제거하기 (범인 찾기 게임)

이제 가장 강력한 기술입니다. **체계적으로 코드를 제거하는 것.**

### 프로세스 (반드시 순서대로!)

```
1. 재현 실행 → 버그 확인 ✅
2. 코드 일부를 삭제 (컴포넌트, 함수, 스타일 등)
3. 재현 다시 실행
4. 버그가 여전히 있으면? → 커밋 (그 코드는 무관함)
5. 버그가 사라졌으면? → 롤백하고 더 작은 단위로 삭제
6. 더 이상 제거할 게 없을 때까지 반복
```

### 🎯 핵심 규칙

**항상 버그가 존재하는 상태를 유지하면서 줄여가야 합니다.**

이것은 **잘 정의된 재귀(Well-Founded Recursion)** 개념입니다.

### 비유: 수박 게임

어린이 놀이터에서 하는 "뜨거워, 차가워" 게임을 생각해보세요:

- 올바른 방법: "뜨거워!" → 그 방향으로 계속 → "더 뜨거워!" → 보물 발견!
- 잘못된 방법: "뜨거워!" → 갑자기 다른 곳으로 → "차가워" → "음... 다른 곳?" → 길을 잃음

**항상 "더 뜨거워지는" 방향으로 가야 합니다.**

### Claude의 실수

Dan이 Claude에게 이 과정을 지시했지만, Claude는 실수했습니다:

❌ **Claude가 한 것:**
- "아마 이 effect가 문제일 거야" → 새 테스트 케이스 만듦
- "컴포넌트 리마운트가 문제?" → 또 다른 테스트 만듦
- "React가 이상한 일을?" → 또 새로운 테스트...

결과: 버그가 없는 여러 테스트만 생겼습니다.

✅ **해야 했던 것:**
- 원본 파일에서 컴포넌트 하나 삭제 → 버그 여전? → 커밋
- 또 다른 컴포넌트 삭제 → 버그 여전? → 커밋
- 스타일 제거 → 버그 여전? → 커밋
- ...반복...

### 피보나치 예시로 이해하기

잘못된 재귀 (무한 루프):
```javascript
function fib(n) {
  if (n <= 1) return n;
  return fib(n) + fib(n - 1); // 🔴 fib(n)이 자기 자신 호출!
}
```

올바른 재귀 (점점 작아짐):
```javascript
function fib(n) {
  if (n <= 1) return n;
  return fib(n - 2) + fib(n - 1); // ✅ n이 점점 작아짐
}
```

**버그 잡기도 마찬가지입니다. 항상 "더 작아지고" 있어야 합니다.**

---

## 🎯 Step 4: 근본 원인을 찾기 (보물 발견!)

Dan이 Claude에게 "제대로 따르라"고 다시 지시하자, 진전이 있었습니다.

불필요한 코드를 하나씩 제거한 결과:
- 문제가 한 파일로 좁혀짐
- 그 파일을 라우터 밖으로 옮기니 → 작동함!
- 다시 안으로 옮기니 → 버그 재현!
- 루트 레이아웃 안에서만 문제 발생

**범인 발견:**

```jsx
// 루트 레이아웃 코드
import { Outlet, ScrollRestoration } from "react-router-dom";

export function RootLayout() {
  return (
    <div>
      <ScrollRestoration /> {/* 🔴 범인! */}
      <Outlet />
    </div>
  );
}
```

**진짜 원인:** React Router의 `ScrollRestoration`에 버그가 있었습니다. 경로 변경 시만 작동해야 하는데, 재검증(revalidation)할 때도 작동하는 버그였죠 (이미 6월에 수정됨).

서버 호출 → 재검증 트리거 → ScrollRestoration 작동 → scrollIntoView와 충돌 → 스크롤 흔들림!

**해결책:** React Router를 최신 버전으로 업데이트.

---

## 📚 정리: 버그 잡는 4단계 체크리스트

### ✅ Step 0: 그냥 고치지 마세요
- 재현 없이 추측만 하면 시간 낭비입니다

### ✅ Step 1: 신뢰할 수 있는 재현 만들기
- 무엇을 하는가?
- 무엇이 나와야 하는가?
- 실제로 무엇이 나오는가?
- 매번 같은 결과가 나오는가?

### ✅ Step 2: 재현을 측정 가능하게 좁히기
- 시각적 → 숫자로 (console.log 활용)
- 반드시 검증: 알려진 해결책이 새 재현에서도 작동하는지 확인
- 주의: 다른 버그를 잡고 있지 않은지 항상 체크

### ✅ Step 3: 체계적으로 코드 제거하기
- 버그가 있는 상태를 유지하면서 줄이기
- 버그 여전? → 커밋
- 버그 사라짐? → 롤백 후 더 작은 단위로
- 더 이상 제거할 게 없을 때까지 반복
- **절대**: 새로운 테스트 케이스로 점프하지 않기

### ✅ Step 4: 근본 원인 발견
- 최소한의 재현에 도달하면 원인이 명확해짐
- 내 코드의 실수든, 라이브러리 버그든 드러남

---

## 💡 실전 팁

### 🔥 가장 흔한 실수들

1. **"대충 이것 같은데?"**
   - ❌ 추측으로 바로 고치기
   - ✅ 재현으로 확인하기

2. **"이 이론을 테스트해봐야지"**
   - ❌ 새로운 테스트 케이스 여러 개 만들기
   - ✅ 기존 재현에서 체계적으로 제거하기

3. **"이 부분은 확실히 무관해"**
   - ❌ 가정으로 코드 건너뛰기
   - ✅ 실제로 제거해서 확인하기

### 🎯 언제 이 방법을 쓸까?

- 버그 원인을 모를 때 (대부분의 경우)
- AI가 해결 못 한 버그
- 레거시 코드의 이상한 버그
- 라이브러리 충돌이 의심될 때
- "이상하다... 왜 안 되지?" 라고 1시간째 고민 중일 때

### ⏱️ 시간 절약 팁

- **10분 룰**: 10분 안에 원인을 못 찾으면, 이 4단계를 시작하세요
- **커밋 자주**: 각 단계마다 커밋하면 언제든 되돌릴 수 있습니다
- **새 브랜치**: 실험용 브랜치를 만들어서 마음껏 삭제하세요

---

## 🚀 오늘부터 실천하기

**당장 시도해볼 만한 것:**

1. 지금 고민 중인 버그가 있다면, 재현을 글로 적어보세요
2. 그 재현을 다른 사람(혹은 AI)이 따라 할 수 있는지 확인하세요
3. 측정 가능한 결과로 바꿀 수 있는지 고민해보세요

**기억하세요:**

> "버그를 고치는 것은 예술이 아니라 과학이다.
> 재현이 없다면, 당신은 추측하고 있는 것이다."

---

## 🎓 한 걸음 더: Lean의 Well-Founded Recursion

Dan이 언급한 Lean 프로그래밍 언어는 "잘 정의된 재귀"를 강제합니다. 즉, 재귀가 반드시 "작아지는" 방향으로 가도록 컴파일러가 검증합니다.

버그 잡기도 마찬가지입니다. **항상 "더 작아지고" 있는지 스스로 확인하세요.**

만약 한 시간 전 재현과 지금 재현이 비슷한 크기라면? 잘못된 방향으로 가고 있는 겁니다.

---

## 마치며

AI가 발전해도, 사람이 직접 코딩해도, **체계적인 접근법**은 여전히 가장 강력합니다.

Dan Abramov 같은 React 핵심 개발자도 이 방법을 쓰는 이유는? **효과가 있기 때문**입니다.

다음에 버그를 만나면, 이 글을 다시 읽어보세요. 그리고 한 단계씩 따라가 보세요.

분명 "아하!" 하는 순간이 올 겁니다.

Happy debugging! 🐛🔍

---

## 참고 자료

- 원문: [How to Fix Any Bug by Dan Abramov](https://overreacted.io/how-to-fix-any-bug/)
- [React Router ScrollRestoration 버그](https://github.com/remix-run/react-router/issues/13672)
- [Lean의 Well-Founded Recursion](https://lean-lang.org/doc/reference/latest/Definitions/Recursive-Definitions/#well-founded-recursion)

---

**태그**: 디버깅, 버그 해결, Feynman Technique, 개발 방법론, React, 문제 해결

**읽은 시간**: 12분